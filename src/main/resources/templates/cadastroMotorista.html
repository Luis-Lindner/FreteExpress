<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Fretes Express</title>
    <link rel="stylesheet" href="/css/cadastroMotorista.css">
</head>
<body>
<div class="container">
    <div class="logo-section">
        <img src="/img/logoAnatonnely.png" class="logo" alt="Fretes Express Logo">
        <h2>FRETES EXPRESS</h2>
    </div>
    <div class="form-section">
        <h1>Cadastro Motorista</h1>
        <!-- Mensagens de erro/sucesso -->
        <div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}"></div>
        <div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>

        <!-- O ÚNICO FORMULÁRIO QUE ENVOLVE TODOS OS PASSOS -->
        <!-- th:object e enctype agora estão aqui -->
        <form id="multi-step-form" th:action="@{/finalizar-cadastro}" th:object="${cadastroMotoristaDTO}" method="POST" enctype="multipart/form-data">

            <!-- Indicadores de Passo -->
            <div class="steps-indicator">
                <span id="step-indicator-1" class="active">1</span>
                <span id="step-indicator-2">2</span>
                <span id="step-indicator-3">3</span>
                <span id="step-indicator-4">4</span>
            </div>

            <!-- Formulário 1: Dados Pessoais -->
            <div class="form-step" id="step-1-content">
                <h3>Dados Pessoais</h3>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" th:field="*{email}" required>
                </div>
                <div class="form-group">
                    <label for="senha">Senha</label>
                    <input type="password" id="senha" th:field="*{senha}" required>
                </div>
                <div class="form-group">
                    <label for="nomeCompleto">Nome Completo</label>
                    <input type="text" id="nomeCompleto" th:field="*{nomeCompleto}" required>
                </div>
                <div class="form-group">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" th:field="*{cpf}" required>
                </div>
                <div class="buttons">
                    <button type="button" class="btn voltar" onclick="window.location.href='/login'">Voltar ao Login</button>
                    <button type="button" class="btn continuar" onclick="showStep(2)">Continuar</button>
                </div>
            </div>

            <!-- Formulário 2: Endereço e Contato -->
            <div class="form-step" id="step-2-content" style="display: none;">
                <h3>Endereço e Contato</h3>
                <div class="form-group">
                    <label for="rua">Rua</label>
                    <input type="text" id="rua" th:field="*{rua}" required>
                </div>
                <div class="form-group">
                    <label for="numero">Número</label>
                    <input type="text" id="numero" th:field="*{numero}" required>
                </div>
                <div class="form-group">
                    <label for="bairro">Bairro</label>
                    <input type="text" id="bairro" th:field="*{bairro}" required>
                </div>
                <div class="form-group">
                    <label for="cep">CEP</label>
                    <input type="text" id="cep" th:field="*{cep}" required>
                </div>
                <div class="form-group">
                    <label for="complemento">Complemento (Opcional)</label>
                    <input type="text" id="complemento" th:field="*{complemento}">
                </div>
                <div class="form-group">
                    <label for="cidadeNome">Cidade</label>
                    <input type="text" id="cidadeNome" th:field="*{cidadeNome}" required>
                </div>
                <div class="form-group">
                    <label for="estadoNome">Estado</label>
                    <input type="text" id="estadoNome" th:field="*{estadoNome}" required>
                </div>
                <div class="form-group">
                    <label for="celular">Celular</label>
                    <input type="tel" id="celular" th:field="*{celular}" required>
                </div>
                <div class="buttons">
                    <button type="button" class="btn voltar" onclick="showStep(1)">Voltar</button>
                    <button type="button" class="btn continuar" onclick="showStep(3)">Continuar</button>
                </div>
            </div>

            <!-- Formulário 3: Foto -->
            <div class="form-step" id="step-3-content" style="display: none;">
                <h3>Foto de Perfil</h3>
                <div class="form-group">
                    <label for="foto">Foto</label>
                    <input type="file" id="foto" name="foto" accept="image/*"> <!-- name="foto" para @RequestParam MultipartFile -->
                </div>
                <div class="buttons">
                    <button type="button" class="btn voltar" onclick="showStep(2)">Voltar</button>
                    <button type="button" class="btn continuar" onclick="showStep(4)">Continuar</button>
                </div>
            </div>

            <!-- Formulário 4: Cadastro Veículo -->
            <div class="form-step" id="step-4-content" style="display: none;">
                <h3>Dados do Veículo</h3>
                <div class="form-group">
                    <label for="placa">Placa</label>
                    <input type="text" id="placa" th:field="*{placa}" required>
                </div>
                <div class="form-group">
                    <label for="modelo">Modelo</label>
                    <input type="text" id="modelo" th:field="*{modelo}" required>
                </div>
                <div class="form-group">
                    <label for="ano">Ano</label>
                    <input type="number" id="ano" th:field="*{ano}" required>
                </div>
                <div class="form-group">
                    <label for="tipo">Tipo de Veículo</label>
                    <select id="tipo" th:field="*{tipo}" required>
                        <option value="" disabled selected>Selecione o tipo</option>
                        <option value="carro">Carro</option>
                        <option value="moto">Moto</option>
                        <option value="caminhao">Caminhão</option>
                    </select>
                </div>
                <!-- Se você tiver outros campos de veículo no seu DTO, adicione-os aqui com th:field -->
                <!-- Exemplo: -->
                <!-- <div class="form-group">
                    <label for="renavam">RENAVAM</label>
                    <input type="text" id="renavam" th:field="*{renavam}">
                </div> -->

                <div class="buttons">
                    <button type="button" class="btn voltar" onclick="showStep(3)">Voltar</button>
                    <button type="submit" class="btn finalizar">Finalizar Cadastro</button> <!-- Este botão SUBMETE o formulário -->
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Script JavaScript para controle dos passos do formulário
    const formSteps = document.querySelectorAll('.form-step');
    const stepIndicators = document.querySelectorAll('.steps-indicator span');
    let currentStep = 1;

    function showStep(stepNum) {
        // Validação básica antes de avançar (apenas para campos visíveis no passo atual)
        if (stepNum > currentStep) { // Se estiver avançando
            const currentFormGroupInputs = formSteps[currentStep - 1].querySelectorAll('[required]');
            let isValid = true;
            currentFormGroupInputs.forEach(input => {
                if (!input.checkValidity()) {
                    isValid = false;
                    input.reportValidity(); // Mostra a mensagem de erro do navegador
                }
            });
            if (!isValid) {
                return; // Não avança se a validação falhar
            }
        }

        formSteps.forEach((step, index) => {
            step.style.display = 'none'; // Esconde todos os passos
            stepIndicators[index].classList.remove('active'); // Remove a classe 'active' de todos os indicadores
        });

        formSteps[stepNum - 1].style.display = 'block'; // Mostra o passo atual
        stepIndicators[stepNum - 1].classList.add('active'); // Ativa o indicador do passo atual
        currentStep = stepNum;
    }

    // Inicializa mostrando o primeiro passo
    document.addEventListener('DOMContentLoaded', () => {
        showStep(1);
    });
</script>
</body>
</html>
